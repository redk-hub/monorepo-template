# Monorepo å‰ç«¯é¡¹ç›®

ä¸€ä¸ªåŸºäº pnpm workspace çš„ç°ä»£åŒ–å‰ç«¯ monorepo é¡¹ç›®ï¼Œé‡‡ç”¨æ¨¡å—åŒ–æ¶æ„è®¾è®¡ï¼ŒåŒ…å«ä¸» Web åº”ç”¨å’Œå¤šä¸ªå¯å¤ç”¨åŒ…ã€‚
![alt text](/preview/image.png)
![alt text](/preview/image2.png)

## ğŸš€ é¡¹ç›®ä¼˜åŠ¿

- **èŠ‚çœç£ç›˜ç©ºé—´**ï¼šå…±äº«ä¾èµ–ï¼Œå‡å°‘é‡å¤å®‰è£…
- **ç»Ÿä¸€ä¾èµ–ç‰ˆæœ¬**ï¼šç¡®ä¿æ‰€æœ‰åŒ…ä½¿ç”¨ç›¸åŒç‰ˆæœ¬çš„ä¾èµ–
- **è·¨åŒ…åä½œä¸å¤ç”¨**ï¼šç»„ä»¶ã€å·¥å…·ã€hooks å¯åœ¨ä¸åŒåº”ç”¨é—´å…±äº«
- **æå‡æ„å»ºæ•ˆç‡**ï¼šå¢é‡æ„å»ºå’Œç¼“å­˜ä¼˜åŒ–

## ğŸ“ é¡¹ç›®ç»“æ„

```
my-repo/
â”œâ”€â”€ apps/
â”‚   â””â”€â”€ web/                 # ä¸» Web åº”ç”¨ (Vite + React)
â”‚       â”œâ”€â”€ src/
â”‚       â”‚   â”œâ”€â”€ pages/       # é¡µé¢ç»„ä»¶
â”‚       â”‚   â”œâ”€â”€ router/      # è·¯ç”±é…ç½®
â”‚       â”‚   â”œâ”€â”€ Layout/      # å¸ƒå±€ç»„ä»¶
â”‚       â”‚   â””â”€â”€ mocks/       # æ¨¡æ‹Ÿæ•°æ®
â”‚       â”œâ”€â”€ package.json
â”‚       â””â”€â”€ vite.config.js
â”œâ”€â”€ packages/
â”‚   â”œâ”€â”€ hooks/              # å…¬å…± Hooks
â”‚   â”œâ”€â”€ pc-ui/             # PC ç«¯ç»„ä»¶åº“
â”‚   â”œâ”€â”€ mobile-ui/         # ç§»åŠ¨ç«¯ç»„ä»¶åº“
â”‚   â””â”€â”€ utils/             # å·¥å…·å‡½æ•°
â”œâ”€â”€ package.json
â””â”€â”€ pnpm-workspace.yaml
```

## ğŸ“¦ åŒ…èŒè´£è¯´æ˜

### apps/web

ä¸»ç«™åº”ç”¨ï¼ŒåŸºäº Vite + React æ„å»ºï¼Œè´Ÿè´£ï¼š

- é¡µé¢è·¯ç”±å’Œå¯¼èˆª
- UI ç»„ä»¶ç»„è£…
- ä¸åç«¯ API é€šä¿¡
- ç”¨æˆ·ç•Œé¢æ¸²æŸ“

### packages/hooks

å¯å¤ç”¨ React Hooksï¼š

- `usePermission` - æƒé™ç®¡ç†
- `useUserStore` - ç”¨æˆ·çŠ¶æ€ç®¡ç†
- `useCurMenu` - å½“å‰èœå•çŠ¶æ€

### packages/pc-ui & packages/mobile-ui

å“åº”å¼ UI ç»„ä»¶åº“ï¼š

- é€šç”¨ UI ç»„ä»¶
- é€‚é…ä¸åŒè®¾å¤‡çš„ç»„ä»¶ç‰ˆæœ¬
- ç»Ÿä¸€çš„æ ·å¼è§„èŒƒ

### packages/utils

å·¥å…·å‡½æ•°åº“ï¼š

- HTTP è¯·æ±‚å°è£…
- æ—¥æœŸå¤„ç†å·¥å…·
- é€šç”¨å·¥å…·æ–¹æ³•

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

- **React 18** - ç”¨æˆ·ç•Œé¢æ„å»º
- **Vite** - æ„å»ºå·¥å…·å’Œå¼€å‘æœåŠ¡å™¨
- **React Router** - å®¢æˆ·ç«¯è·¯ç”±
- **React Query** - æ•°æ®è·å–å’ŒçŠ¶æ€ç®¡ç†

### æ•°æ®ç®¡ç†

- **React Query (TanStack Query)** - å¼ºå¤§çš„æ•°æ®åŒæ­¥å’Œç¼“å­˜ç®¡ç†
- **axios-mock-adapter** - HTTP è¯·æ±‚æ¨¡æ‹Ÿå’Œæµ‹è¯•å·¥å…·

### å¼€å‘å·¥å…·

- **pnpm** - åŒ…ç®¡ç†å™¨ (workspace æ¨¡å¼)
- **ESLint** - ä»£ç è´¨é‡æ£€æŸ¥
- **Prettier** - ä»£ç æ ¼å¼åŒ–

## ğŸƒâ€â™‚ï¸ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Node.js 18+
- pnpm 7+

### å®‰è£…ä¾èµ–

```bash
# åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ
pnpm install
```

### å¯åŠ¨å¼€å‘æœåŠ¡å™¨

```bash
# å¯åŠ¨ web åº”ç”¨
pnpm --filter apps/web start:dev

# æˆ–è€…è¿›å…¥ apps/web ç›®å½•è¿è¡Œ
cd apps/web
pnpm start:dev
```

### æ„å»ºå’Œæµ‹è¯•

```bash
# ä»£ç æ£€æŸ¥
pnpm lint

# ä»£ç æ ¼å¼åŒ–
pnpm format
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½ç¤ºä¾‹

### React Query æ•°æ®ç®¡ç†

é¡¹ç›®æ·±åº¦é›†æˆ React Query (TanStack Query) è¿›è¡Œæ•°æ®ç®¡ç†ï¼Œæä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š

#### åŸºç¡€æŸ¥è¯¢ (Basic Query)

```jsx
// ä½¿ç”¨ useQuery è¿›è¡Œæ•°æ®è·å–
const { data, isLoading, isError } = useQuery({
  queryKey: ['users', { page: 1, size: 5 }],
  queryFn: fetchUsers,
});
```

#### é«˜çº§åŠŸèƒ½

- **åˆ†é¡µæŸ¥è¯¢** - æ”¯æŒåˆ†é¡µæ•°æ®çš„ç¼“å­˜å’ŒåŒæ­¥
- **æ— é™æ»šåŠ¨** - å®ç°æ— é™åŠ è½½åˆ—è¡¨
- **ä¾èµ–æŸ¥è¯¢** - åŸºäºå…¶ä»–æŸ¥è¯¢ç»“æœçš„æ•°æ®è·å–
- **å¹¶è¡ŒæŸ¥è¯¢** - åŒæ—¶å‘èµ·å¤šä¸ªè¯·æ±‚
- **æ•°æ®å˜æ›´** - ä½¿ç”¨ useMutation å¤„ç†æ•°æ®ä¿®æ”¹
- **é¢„åŠ è½½å’Œå¤±æ•ˆ** - ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ

#### é…ç½®é€‰é¡¹

```jsx
// queryClient.js ä¸­çš„å…¨å±€é…ç½®
const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
      retry: 1,
      refetchOnWindowFocus: false,
      staleTime: 1000 * 30, // 30ç§’
      gcTime: 1000 * 60 * 5, // 5åˆ†é’Ÿ
    },
  },
});
```

### Mock API æ¨¡æ‹Ÿ

ä½¿ç”¨ `axios-mock-adapter` è¿›è¡Œ API è¯·æ±‚æ¨¡æ‹Ÿï¼Œæ”¯æŒï¼š

#### è¯·æ±‚æ‹¦æˆªå’Œå“åº”æ¨¡æ‹Ÿ

```jsx
// mockApi.js ä¸­çš„é…ç½®
const mock = new MockAdapter(request, { delayResponse: 500 });

// GET è¯·æ±‚æ¨¡æ‹Ÿ
mock.onGet('/api/users').reply((config) => {
  const params = config.params || {};
  const page = parseInt(params.page || 1, 10);
  const size = parseInt(params.size || 5, 10);
  // è¿”å›æ¨¡æ‹Ÿæ•°æ®
  return [200, { code: 0, data: { list: [], total: 0 } }];
});
```

#### æ”¯æŒçš„ HTTP æ–¹æ³•

- `GET` - æ•°æ®æŸ¥è¯¢
- `POST` - æ•°æ®åˆ›å»º
- `PATCH` - æ•°æ®æ›´æ–°
- `DELETE` - æ•°æ®åˆ é™¤

#### ç‰¹æ€§

- **å»¶è¿Ÿå“åº”** - æ¨¡æ‹ŸçœŸå®ç½‘ç»œå»¶è¿Ÿ
- **å‚æ•°è§£æ** - æ”¯æŒ URL å‚æ•°å’Œè¯·æ±‚ä½“è§£æ
- **é”™è¯¯æ¨¡æ‹Ÿ** - æ”¯æŒå„ç§ HTTP çŠ¶æ€ç å’Œé”™è¯¯å“åº”
- **åŠ¨æ€æ•°æ®** - åŸºäºè¯·æ±‚å‚æ•°è¿”å›ä¸åŒæ•°æ®

### User æ¨¡å—çŠ¶æ€ä¿æŒå®ç°

åœ¨ `apps/web/src/pages/User/` ç›®å½•ä¸‹æä¾›äº†ä»åˆ—è¡¨é¡µè·³è½¬åˆ°è¯¦æƒ…é¡µå¹¶ä¿æŒåˆ—è¡¨çŠ¶æ€çš„å®Œæ•´å®ç°ç¤ºä¾‹ã€‚

#### å®ç°ç›®æ ‡

ä»ç”¨æˆ·åˆ—è¡¨é¡µè·³è½¬åˆ°è¯¦æƒ…é¡µï¼Œè¿”å›æ—¶ä¿æŒåˆ—è¡¨çš„ï¼š

- åˆ†é¡µçŠ¶æ€
- ç­›é€‰æ¡ä»¶
- æ’åºè®¾ç½®
- æ»šåŠ¨ä½ç½®

#### å®ç°æ–¹æ¡ˆ

**æ–¹æ¡ˆä¸€ï¼šçŠ¶æ€æå‡ (ListLayout)**

```jsx
// ListLayout.jsx - çˆ¶ç»„ä»¶ç®¡ç†çŠ¶æ€
const [listState, setListState] = useState({
  page: 1,
  pageSize: 10,
  filters: {},
  sort: {},
  scrollTop: 0,
});

// ä¼ é€’ç»™å­ç»„ä»¶
<List listState={listState} onStateChange={setListState} />;
```

**æ–¹æ¡ˆäºŒï¼šå…¨å±€çŠ¶æ€ç®¡ç† (pages/react-query/Pagination.jsx)**

```jsx
// è®°å½•é¡µé¢å‚æ•°
const [page, setPage] = useState(() => {
  return Number(sessionStorage.getItem('last_page')) || 1;
});

// è¿”å›é¡µé¢ä» sessionStorage ä¸­è·å–ï¼Œreact-queryå–å¯¹åº”keyçš„åˆ—è¡¨æ•°æ®
```

## ğŸ“š å¼€å‘æŒ‡å—

### æ·»åŠ æ–°é¡µé¢

1. åœ¨ `apps/web/src/pages/` åˆ›å»ºé¡µé¢ç»„ä»¶
2. åœ¨ `apps/web/src/router/routeConfig.jsx` é…ç½®è·¯ç”±
3. ä½¿ç”¨ `packages/pc-ui` æˆ– `packages/mobile-ui` ä¸­çš„ç»„ä»¶

### åˆ›å»ºå¯å¤ç”¨åŒ…

1. åœ¨ `packages/` ç›®å½•ä¸‹åˆ›å»ºæ–°åŒ…
2. é…ç½®åŒ…çš„ `package.json`
3. åœ¨å…¶ä»–åº”ç”¨ä¸­é€šè¿‡ workspace å¼•ç”¨

### ä»£ç è§„èŒƒ

- ä½¿ç”¨æä¾›çš„ ESLint å’Œ Prettier é…ç½®
- éµå¾ª React Hooks æœ€ä½³å®è·µ
- ç»„ä»¶å’Œå‡½æ•°ä½¿ç”¨æ¸…æ™°çš„å‘½å

## ğŸ¤ è´¡çŒ®æŒ‡å—

æ¬¢è¿æäº¤ Issue å’Œ Pull Request æ¥æ”¹è¿›é¡¹ç›®ï¼

---

**é¡¹ç›®æŒç»­ç»´æŠ¤ä¸­ï¼Œå¦‚æœ‰é—®é¢˜è¯·æŸ¥çœ‹ Issues æˆ–æäº¤æ–°çš„ Issueã€‚**
